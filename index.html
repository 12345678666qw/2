<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幸运大转盘抽奖 - 专业版</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif; 
        }
        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%); 
            color: #333; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            overflow-x: hidden; 
            background-attachment: fixed;
        }
        .container { 
            max-width: 1200px; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border-radius: 20px;
            overflow: hidden;
            background: white;
        }
        header { 
            text-align: center; 
            margin-bottom: 30px; 
            width: 100%; 
            padding: 25px 0;
            background: linear-gradient(120deg, #e74c3c, #c0392b);
            color: white;
        }
        h1 { 
            font-size: 2.8rem; 
            margin-bottom: 10px; 
            color: #fff; 
            letter-spacing: 2px; 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            position: relative;
            display: inline-block;
        }
        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: #f1c40f;
            border-radius: 2px;
        }
        .subtitle { 
            font-size: 1.3rem; 
            margin-top: 15px;
            color: #f8f9fa; 
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .content { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 40px; 
            width: 100%; 
            padding: 0 30px 30px;
        }
        
        .wheel-container { 
            position: relative; 
            width: 450px; 
            height: 450px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-top: 20px;
            perspective: 1000px;
        }
        .wheel { 
            width: 100%; 
            height: 100%; 
            border-radius: 50%; 
            background: white; 
            position: relative; 
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.21, 0.99); 
            box-shadow: 0 0 35px rgba(0, 0, 0, 0.2), inset 0 0 20px rgba(0, 0, 0, 0.15); 
            overflow: hidden; 
            border: 12px solid #f1c40f;
            transform-style: preserve-3d;
        }
        .wheel::before { 
            content: ''; 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            right: 20px; 
            bottom: 20px; 
            border-radius: 50%; 
            border: 3px solid rgba(0, 0, 0, 0.1); 
            pointer-events: none; 
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5) inset;
        }
        .pointer { 
            position: absolute; 
            top: -30px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 50px; 
            height: 70px; 
            background: linear-gradient(to bottom, #e74c3c, #c0392b); 
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%); 
            z-index: 10; 
            filter: drop-shadow(0 8px 15px rgba(0, 0, 0, 0.4)); 
            border-radius: 6px 6px 0 0; 
            animation: pulse 2s infinite;
        }
        .pointer::after { 
            content: ''; 
            position: absolute; 
            top: 15px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 25px; 
            height: 25px; 
            background: #f1c40f; 
            border-radius: 50%; 
            box-shadow: 0 0 15px #f1c40f; 
            animation: glow 2s infinite alternate;
        }
        
        .wheel-section { 
            position: absolute; 
            width: 50%; 
            height: 50%; 
            transform-origin: bottom right; 
            left: 0; 
            top: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            font-weight: bold; 
            color: #fff; 
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            border-right: 3px solid rgba(0, 0, 0, 0.15);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1) inset;
        }
        .wheel-section:nth-child(1) { transform: rotate(0deg); background: linear-gradient(135deg, #ff9ff3, #f368e0); }
        .wheel-section:nth-child(2) { transform: rotate(60deg); background: linear-gradient(135deg, #feca57, #ff9f43); }
        .wheel-section:nth-child(3) { transform: rotate(120deg); background: linear-gradient(135deg, #ff6b6b, #ee5253); }
        .wheel-section:nth-child(4) { transform: rotate(180deg); background: linear-gradient(135deg, #48dbfb, #0abde3); }
        .wheel-section:nth-child(5) { transform: rotate(240deg); background: linear-gradient(135deg, #1dd1a1, #10ac84); }
        .wheel-section:nth-child(6) { transform: rotate(300deg); background: linear-gradient(135deg, #ff9ff3, #f368e0); }
        
        .section-content { 
            transform: rotate(30deg); 
            font-size: 20px; 
            width: 85px; 
            text-align: center; 
            font-weight: bold; 
            padding: 10px; 
            border-radius: 10px; 
            background: rgba(0, 0, 0, 0.15); 
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2); 
            backdrop-filter: blur(3px);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }
        
        .controls { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 25px; 
            margin-top: 20px;
            width: 100%;
            padding: 0 30px 30px;
        }
        .spin-btn { 
            background: linear-gradient(to bottom, #e74c3c, #c0392b); 
            color: white; 
            border: none; 
            padding: 20px 60px; 
            font-size: 1.5rem; 
            border-radius: 55px; 
            cursor: pointer; 
            transition: all 0.4s ease; 
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            font-weight: bold; 
            position: relative; 
            overflow: hidden; 
            z-index: 1;
            width: 280px;
            transform: translateY(0);
            border: 3px solid #b02a1a;
        }
        .spin-btn:hover:not(:disabled) { 
            transform: translateY(-7px); 
            box-shadow: 0 12px 25px rgba(231, 76, 60, 0.5); 
        }
        .spin-btn:active:not(:disabled) {
            transform: translateY(-3px);
        }
        .spin-btn:disabled { 
            background: #bdc3c7; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
            border-color: #95a5a6;
        }
        .spin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.6s;
            z-index: -1;
        }
        .spin-btn:hover:not(:disabled)::before {
            left: 100%;
        }
        
        .prizes-info { 
            background: white; 
            border-radius: 20px; 
            padding: 25px; 
            width: 340px; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12); 
            border: 1px solid #ecf0f1;
            transition: all 0.3s ease;
        }
        .prizes-info:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.18);
        }
        .prizes-info h2 { 
            text-align: center; 
            margin-bottom: 20px; 
            font-size: 1.9rem; 
            color: #e74c3c; 
            text-shadow: 0 0 10px rgba(231, 76, 60, 0.2);
            position: relative;
        }
        .prizes-info h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: #f1c40f;
            border-radius: 2px;
        }
        .prize-list { 
            list-style-type: none; 
        }
        .prize-item { 
            padding: 14px 0; 
            border-bottom: 1px solid #f1f1f1; 
            display: flex; 
            justify-content: space-between; 
            font-size: 1.15rem; 
            transition: all 0.3s; 
            position: relative;
            overflow: hidden;
        }
        .prize-item::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background: #e74c3c;
            transition: width 0.3s;
        }
        .prize-item:hover::before {
            width: 100%;
        }
        .prize-item:hover { 
            background: #fef2f2; 
            padding-left: 15px; 
            border-radius: 8px; 
        }
        .prize-item:last-child { 
            border-bottom: none; 
        }
        .prize-item .prize-name {
            font-weight: bold;
            color: #e74c3c;
        }
        .prize-item .prize-desc {
            color: #7f8c8d;
            font-style: italic;
        }
        
        .video-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.98); 
            z-index: 100; 
            display: none; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
            backdrop-filter: blur(5px);
        }
        .video-player { 
            width: 85%; 
            height: 75%; 
            object-fit: contain; 
            border-radius: 15px; 
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.15);
            border: 2px solid #e74c3c;
        }
        .video-player::-webkit-media-controls { display: none !important; }
        
        .close-video { 
            position: absolute; 
            top: 25px; 
            right: 25px; 
            background: rgba(0, 0, 0, 0.7); 
            color: white; 
            border: 2px solid white; 
            width: 55px; 
            height: 55px; 
            border-radius: 50%; 
            font-size: 2rem; 
            cursor: pointer; 
            z-index: 101; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            transition: all 0.3s; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .close-video:hover { 
            background: rgba(255, 0, 0, 0.8); 
            transform: rotate(90deg); 
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.4);
        }
        
        .loading { 
            text-align: center; 
            margin-top: 20px; 
            font-size: 1.3rem; 
            background: #f8f9fa; 
            padding: 15px 25px; 
            border-radius: 15px; 
            color: #e74c3c; 
            width: 100%; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #e74c3c;
        }
        
        .progress-container { 
            width: 100%; 
            background-color: #e9ecef; 
            border-radius: 10px; 
            margin-top: 15px; 
            overflow: hidden;
            height: 12px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(to right, #e74c3c, #c0392b); 
            width: 0%; 
            transition: width 0.4s ease; 
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
        }
        
        .result { 
            margin-top: 25px; 
            font-size: 1.9rem; 
            text-align: center; 
            min-height: 80px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: #fff8f8; 
            padding: 20px 35px; 
            border-radius: 20px; 
            width: 100%; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 2px dashed #ffebee;
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateY(20px);
        }
        .result.show {
            opacity: 1;
            transform: translateY(0);
        }
        .result-prize { 
            font-weight: bold; 
            color: #e74c3c; 
            font-size: 2.3rem; 
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: pulse 1.5s infinite;
        }
        
        .replay-prompt { 
            position: absolute; 
            bottom: 40px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(0, 0, 0, 0.85); 
            color: white; 
            padding: 20px 30px; 
            border-radius: 15px; 
            display: none; 
            z-index: 102; 
            text-align: center; 
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 80%;
            max-width: 500px;
        }
        .replay-prompt p { 
            margin-bottom: 20px; 
            font-size: 1.3rem; 
            line-height: 1.5;
        }
        .replay-buttons { 
            display: flex; 
            gap: 20px; 
            justify-content: center; 
        }
        .replay-btn { 
            padding: 12px 30px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            font-weight: bold;
            transition: all 0.3s; 
            min-width: 140px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        .replay-yes { 
            background: linear-gradient(to bottom, #e74c3c, #c0392b); 
            color: white; 
        }
        .replay-no { 
            background: linear-gradient(to bottom, #7f8c8d, #6c7a89); 
            color: white; 
        }
        .replay-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); 
        }
        
        .video-container.landscape { 
            transform: rotate(90deg); 
            transform-origin: center; 
            width: 100vh; 
            height: 100vw; 
            top: 50%; 
            left: 50%; 
            margin-top: -50vw; 
            margin-left: -50vh; 
        }
        
        /* 想屁吃特效样式 */
        .xiang-pi-chi {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 8rem;
            font-weight: bold;
            color: #e74c3c;
            text-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
            z-index: 1000;
            animation: xiang-pi-chi-animation 3s ease-out forwards;
            pointer-events: none;
            text-align: center;
            background: linear-gradient(45deg, #ff0000, #cc0000);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        @keyframes xiang-pi-chi-animation {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            15% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
            30% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            70% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 0; }
        }
        
        /* 网络错误提示 */
        .network-error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.25);
            border: 2px solid #e74c3c;
            max-width: 90%;
            width: 450px;
            backdrop-filter: blur(10px);
        }
        
        .network-error h3 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: #e74c3c;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .network-error h3::before, .network-error h3::after {
            content: '!';
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            line-height: 30px;
            font-weight: bold;
        }
        
        .network-error p {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #555;
        }
        
        .network-error .error-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .error-btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }
        
        .retry-btn {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            color: white;
        }
        
        .cancel-btn {
            background: linear-gradient(to bottom, #7f8c8d, #6c7a89);
            color: white;
        }
        
        .error-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* 系统状态指示器 */
        .system-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            z-index: 999;
            font-size: 0.95rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2ecc71;
            box-shadow: 0 0 8px #2ecc71;
        }
        
        /* 奖品高亮效果 */
        @keyframes prizeHighlight {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        .prize-highlight {
            animation: prizeHighlight 1.5s ease;
        }
        
        /* 脉冲动画 */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(241, 196, 15, 0); }
            100% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0); }
        }
        @keyframes glow {
            0% { box-shadow: 0 0 15px #f1c40f; }
            100% { box-shadow: 0 0 25px #ffeb3b; }
        }
        
        @media (max-width: 992px) {
            .content { 
                gap: 30px; 
                padding: 0 20px 25px;
            }
            .wheel-container { 
                width: 380px; 
                height: 380px; 
            }
            .prizes-info { 
                width: 100%; 
                max-width: 400px; 
            }
            .xiang-pi-chi { 
                font-size: 5.5rem; 
            }
        }
        
        @media (max-width: 768px) {
            .content { 
                flex-direction: column; 
                align-items: center; 
                gap: 25px; 
            }
            .wheel-container { 
                width: 320px; 
                height: 320px; 
            }
            .section-content { 
                font-size: 17px; 
                width: 75px; 
            }
            h1 { 
                font-size: 2.2rem; 
            }
            .spin-btn { 
                padding: 18px 50px; 
                font-size: 1.35rem; 
            }
            .prizes-info { 
                width: 100%; 
                max-width: 100%; 
            }
            .network-error {
                width: 90%;
                padding: 25px;
            }
            .network-error p {
                font-size: 1.15rem;
            }
            .xiang-pi-chi { 
                font-size: 4.5rem; 
            }
        }
        
        @media (max-width: 480px) {
            h1 { 
                font-size: 1.9rem; 
            }
            .wheel-container { 
                width: 280px; 
                height: 280px; 
            }
            .section-content { 
                font-size: 15px; 
                width: 65px; 
                padding: 6px;
            }
            .spin-btn { 
                padding: 16px 40px; 
                font-size: 1.2rem; 
                width: 240px;
            }
            .prize-item { 
                font-size: 1.05rem; 
                padding: 12px 0;
            }
            .result { 
                font-size: 1.6rem; 
                min-height: 70px;
                padding: 15px 25px;
            }
            .result-prize { 
                font-size: 1.9rem; 
            }
            .network-error h3 {
                font-size: 1.8rem;
            }
            .network-error p {
                font-size: 1.05rem;
            }
            .xiang-pi-chi { 
                font-size: 3.5rem; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>幸运大转盘抽奖</h1>
            <p class="subtitle">转动转盘，赢取惊喜大奖！每次抽奖都有机会获得特等奖，100%中奖！</p>
        </header>
        
        <div class="content">
            <div class="wheel-container">
                <div class="pointer"></div>
                <div class="wheel" id="wheel">
                    <div class="wheel-section"><div class="section-content">状元</div></div>
                    <div class="wheel-section"><div class="section-content">参与奖1</div></div>
                    <div class="wheel-section"><div class="wheel-section-content"><div class="section-content">参与奖2</div></div></div>
                    <div class="wheel-section"><div class="section-content">参与奖3</div></div>
                    <div class="wheel-section"><div class="section-content">参与奖4</div></div>
                    <div class="wheel-section"><div class="section-content">参与奖5</div></div>
                </div>
            </div>
            
            <div class="prizes-info">
                <h2>奖项设置</h2>
                <ul class="prize-list">
                    <li class="prize-item"><span class="prize-name">状元</span><span class="prize-desc">特等奖</span></li>
                    <li class="prize-item"><span class="prize-name">参与奖1</span><span class="prize-desc">一等奖</span></li>
                    <li class="prize-item"><span class="prize-name">参与奖2</span><span class="prize-desc">二等奖</span></li>
                    <li class="prize-item"><span class="prize-name">参与奖3</span><span class="prize-desc">三等奖</span></li>
                    <li class="prize-item"><span class="prize-name">参与奖4</span><span class="prize-desc">四等奖</span></li>
                    <li class="prize-item"><span class="prize-name">参与奖5</span><span class="prize-desc">五等奖</span></li>
                </ul>
            </div>
        </div>
        
        <div class="controls">
            <button class="spin-btn" id="spinBtn">开始抽奖</button>
            <div class="loading" id="loading" style="display: none;">
                视频加载中，请稍候...
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
            <div class="result" id="result"></div>
        </div>
    </div>
    
    <div class="video-container" id="videoContainer">
        <button class="close-video" id="closeVideo">×</button>
        <video class="video-player" id="videoPlayer" playsinline></video>
        <div class="replay-prompt" id="replayPrompt">
            <p>恭喜您获得 <span id="replayPrizeName" style="color: #e74c3c; font-weight: bold;">奖项名称</span>！<br>是否想再看一遍获奖视频？</p>
            <div class="replay-buttons">
                <button class="replay-btn replay-yes" id="replayYes">再看一遍</button>
                <button class="replay-btn replay-no" id="replayNo">不用了</button>
            </div>
        </div>
    </div>
    
    <div class="network-error" id="networkError" style="display: none;">
        <h3>网络连接问题</h3>
        <p>视频加载失败，请检查您的网络连接<br>或尝试重新加载视频</p>
        <div class="error-actions">
            <button class="error-btn retry-btn" id="retryNetwork">重新加载</button>
            <button class="error-btn cancel-btn" id="closeNetworkError">取消</button>
        </div>
    </div>
    
    <div class="system-status" id="systemStatus">
        <div class="status-dot"></div>
        <span>系统运行正常</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM元素
            const wheel = document.getElementById('wheel');
            const spinBtn = document.getElementById('spinBtn');
            const result = document.getElementById('result');
            const loading = document.getElementById('loading');
            const progressBar = document.getElementById('progressBar');
            const videoContainer = document.getElementById('videoContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            const closeVideo = document.getElementById('closeVideo');
            const replayPrompt = document.getElementById('replayPrompt');
            const replayPrizeName = document.getElementById('replayPrizeName');
            const replayYes = document.getElementById('replayYes');
            const replayNo = document.getElementById('replayNo');
            const networkError = document.getElementById('networkError');
            const retryNetwork = document.getElementById('retryNetwork');
            const closeNetworkError = document.getElementById('closeNetworkError');
            const systemStatus = document.getElementById('systemStatus');
            
            // 系统状态
            let currentPrize = null;
            let nextPrize = null;
            let isSpinning = false;
            let isFirstLoad = true;
            let videoLoadTimeout = null;
            let currentRotation = 0;
            let retryCount = 0;
            const MAX_RETRY = 3;
            const FIXED_ROTATION_COUNT = 5;
            const PRIZE_COUNT = 6;
            
            // 视频缓存
            const videoCache = {};
            const loadStatus = {};
            
            // 奖项数据
            const prizes = [
                { name: "状元", video: "https://raw.githubusercontent.com/12345678666qw/2/refs/heads/main/5ef9303111a910685bad08f415520d89.mp4", weight: 1 },
                { name: "参与奖1", video: "https://raw.githubusercontent.com/12345678666qw/2/refs/heads/main/250a271e1aa8a12b55c85e46e046f68c.mp4", weight: 3 },
                { name: "参与奖2", video: "https://raw.githubusercontent.com/12345678666qw/2/refs/heads/main/a4aed726f1ea371cd79555669ddbd083.mp4", weight: 5 },
                { name: "参与奖3", video: "https://raw.githubusercontent.com/12345678666qw/2/refs/heads/main/a41fb48c8f54cc4cfe1db71850d29122.mp4", weight: 7 },
                { name: "参与奖4", video: "https://raw.githubusercontent.com/12345678666qw/2/refs/heads/main/653046b2c1fc849e69b6205d3164a25e.mp4", weight: 9 },
                { name: "参与奖5", video: "https://raw.githubusercontent.com/12345678666qw/2/refs/heads/main/2c0b601932a2a57f80c0182c770c0fcc.mp4", weight: 11 }
            ];
            
            // 初始化系统
            function initSystem() {
                updateSystemStatus("系统初始化中...", "warning");
                setTimeout(() => {
                    // 预加载第一个奖品
                    initializeFirstPrize();
                    updateSystemStatus("系统运行正常", "success");
                }, 800);
            }
            
            // 更新系统状态
            function updateSystemStatus(message, status) {
                const statusDot = systemStatus.querySelector('.status-dot');
                
                if (status === "success") {
                    statusDot.style.background = "#2ecc71";
                    statusDot.style.boxShadow = "0 0 8px #2ecc71";
                } else if (status === "warning") {
                    statusDot.style.background = "#f39c12";
                    statusDot.style.boxShadow = "0 0 8px #f39c12";
                } else if (status === "error") {
                    statusDot.style.background = "#e74c3c";
                    statusDot.style.boxShadow = "0 0 8px #e74c3c";
                }
                
                systemStatus.querySelector('span').textContent = message;
            }
            
            // 初始化第一个奖品
            function initializeFirstPrize() {
                // 随机选择第一个结果（考虑权重）
                nextPrize = getRandomPrize();
                
                // 预加载视频
                loadVideo(nextPrize, function(success) {
                    if (success) {
                        setTimeout(() => {
                            spinBtn.disabled = false;
                            loading.style.display = 'none';
                            isFirstLoad = false;
                            updateSystemStatus("系统就绪，点击开始抽奖", "success");
                        }, 1500);
                    } else {
                        // 加载失败，设置重试
                        retryCount++;
                        if (retryCount <= MAX_RETRY) {
                            setTimeout(() => {
                                loadVideo(nextPrize, function(retrySuccess) {
                                    if (retrySuccess) {
                                        spinBtn.disabled = false;
                                        loading.style.display = 'none';
                                        updateSystemStatus("系统就绪，点击开始抽奖", "success");
                                    } else {
                                        spinBtn.disabled = false;
                                        loading.style.display = 'none';
                                        updateSystemStatus("视频加载受限，部分功能可能异常", "warning");
                                    }
                                });
                            }, 2000 * retryCount);
                        } else {
                            spinBtn.disabled = false;
                            loading.style.display = 'none';
                            updateSystemStatus("视频加载受限，部分功能可能异常", "warning");
                        }
                    }
                });
            }
            
            // 权重随机选择
            function getRandomPrize() {
                const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const prize of prizes) {
                    random -= prize.weight;
                    if (random <= 0) {
                        return prize;
                    }
                }
                return prizes[0]; // 默认返回
            }
            
            // 加载视频
            function loadVideo(prize, callback) {
                // 如果已经在加载中，不再重复加载
                if (loadStatus[prize.name] === 'loading') {
                    return;
                }
                
                // 如果已经加载成功，直接返回
                if (videoCache[prize.name]) {
                    if (callback) callback(true);
                    return;
                }
                
                // 标记为加载中
                loadStatus[prize.name] = 'loading';
                updateSystemStatus(`加载 ${prize.name} 视频...`, "warning");
                
                const xhr = new XMLHttpRequest();
                xhr.open('GET', prize.video, true);
                xhr.responseType = 'blob';
                xhr.timeout = 10000; // 10秒超时
                
                xhr.onprogress = function(e) {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressBar.style.width = `${percentComplete}%`;
                    }
                };
                
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        const videoBlob = xhr.response;
                        const videoUrl = URL.createObjectURL(videoBlob);
                        
                        const video = document.createElement('video');
                        video.src = videoUrl;
                        video.preload = 'auto';
                        video.muted = true;
                        video.playsInline = true;
                        
                        // 预加载元数据
                        video.addEventListener('loadedmetadata', function() {
                            videoCache[prize.name] = video;
                            loadStatus[prize.name] = 'success';
                            updateSystemStatus("视频加载成功", "success");
                            
                            if (callback) callback(true);
                        });
                        
                        video.addEventListener('error', function(e) {
                            console.error(`视频元数据加载失败: ${prize.name}`, e);
                            loadStatus[prize.name] = 'error';
                            updateSystemStatus("视频加载失败", "error");
                            if (callback) callback(false);
                        });
                        
                        // 尝试加载
                        video.load();
                    } else {
                        console.error(`视频加载失败 (HTTP ${xhr.status}): ${prize.name}`);
                        loadStatus[prize.name] = 'error';
                        updateSystemStatus("视频加载失败", "error");
                        if (callback) callback(false);
                    }
                };
                
                xhr.onerror = function() {
                    console.error(`视频加载失败 (网络错误): ${prize.name}`);
                    loadStatus[prize.name] = 'error';
                    updateSystemStatus("视频加载失败", "error");
                    if (callback) callback(false);
                };
                
                xhr.ontimeout = function() {
                    console.error(`视频加载超时: ${prize.name}`);
                    loadStatus[prize.name] = 'error';
                    updateSystemStatus("视频加载超时", "error");
                    if (callback) callback(false);
                };
                
                xhr.send();
                
                // 显示加载状态
                loading.style.display = 'block';
                progressBar.style.width = '0%';
            }
            
            // 转动转盘
            function spinWheel() {
                if (isSpinning) return;
                
                isSpinning = true;
                spinBtn.disabled = true;
                result.classList.remove('show');
                result.innerHTML = "转盘启动中...";
                
                // 使用预设的nextPrize作为本次结果
                const prizeIndex = prizes.findIndex(p => p.name === nextPrize.name);
                
                // 计算旋转角度
                const baseRotation = 360 * FIXED_ROTATION_COUNT;
                const sectionAngle = 360 / PRIZE_COUNT;
                const targetAngle = currentRotation + baseRotation + (prizeIndex * sectionAngle) + (sectionAngle / 2);
                
                // 应用旋转
                wheel.style.transform = `rotate(${targetAngle}deg)`;
                
                // 更新当前角度
                currentRotation = targetAngle;
                
                // 等待转盘停止
                setTimeout(() => {
                    // 显示结果
                    currentPrize = nextPrize;
                    result.innerHTML = `恭喜您获得了: <span class="result-prize">${currentPrize.name}</span>`;
                    result.classList.add('show');
                    
                    // 高亮对应的奖品
                    highlightPrize(prizeIndex);
                    
                    // 播放对应视频
                    playPrizeVideo(currentPrize);
                    
                    // 确定下一个结果
                    determineNextPrize();
                    
                    isSpinning = false;
                }, 5000);
            }
            
            // 高亮奖品
            function highlightPrize(index) {
                const prizeItems = document.querySelectorAll('.prize-list .prize-item');
                prizeItems.forEach((item, i) => {
                    if (i === index) {
                        item.classList.add('prize-highlight');
                        setTimeout(() => {
                            item.classList.remove('prize-highlight');
                        }, 1500);
                    }
                });
            }
            
            // 播放获奖视频
            function playPrizeVideo(prize) {
                updateSystemStatus(`播放 ${prize.name} 视频...`, "warning");
                
                if (videoCache[prize.name]) {
                    videoPlayer.src = videoCache[prize.name].src;
                    videoPlayer.volume = (prize.name === "状元") ? 1.0 : 0.6;
                    videoPlayer.muted = false;
                    
                    videoContainer.style.display = 'flex';
                    videoContainer.classList.add('landscape');
                    replayPrizeName.textContent = prize.name;
                    
                    // 重置重试计数
                    retryCount = 0;
                    
                    videoPlayer.play().catch(e => {
                        console.error("视频播放失败:", e);
                        showNetworkError();
                    });
                } else {
                    // 视频未加载，尝试加载
                    loadVideo(prize, function(success) {
                        if (success && videoCache[prize.name]) {
                            videoPlayer.src = videoCache[prize.name].src;
                            videoPlayer.volume = (prize.name === "状元") ? 1.0 : 0.6;
                            videoPlayer.muted = false;
                            
                            videoContainer.style.display = 'flex';
                            videoContainer.classList.add('landscape');
                            replayPrizeName.textContent = prize.name;
                            
                            videoPlayer.play().catch(e => {
                                console.error("视频播放失败:", e);
                                showNetworkError();
                            });
                        } else {
                            showNetworkError();
                        }
                    });
                }
            }
            
            // 确定下一个奖品
            function determineNextPrize() {
                // 随机选择下一个结果
                nextPrize = getRandomPrize();
                
                // 预加载下一个视频
                if (!videoCache[nextPrize.name]) {
                    loadVideo(nextPrize, function(success) {
                        if (success) {
                            updateSystemStatus("已预加载下一个奖品", "success");
                        }
                    });
                } else {
                    updateSystemStatus("已预加载下一个奖品", "success");
                }
            }
            
            // 关闭视频播放器
            function closeVideoPlayer() {
                videoContainer.style.display = 'none';
                videoContainer.classList.remove('landscape');
                videoPlayer.pause();
                videoPlayer.currentTime = 0;
                replayPrompt.style.display = 'none';
                
                // 解锁按钮
                spinBtn.disabled = false;
                updateSystemStatus("系统就绪，点击开始抽奖", "success");
            }
            
            // 重新播放视频
            function replayVideo() {
                videoPlayer.currentTime = 0;
                videoPlayer.play();
                replayPrompt.style.display = 'none';
                updateSystemStatus(`重新播放 ${currentPrize.name} 视频...`, "warning");
            }
            
            // 显示网络错误
            function showNetworkError() {
                networkError.style.display = 'block';
                updateSystemStatus("视频加载失败", "error");
            }
            
            // 重试网络
            function retryNetworkLoad() {
                networkError.style.display = 'none';
                updateSystemStatus("正在重试...", "warning");
                
                if (currentPrize && !videoCache[currentPrize.name]) {
                    loadVideo(currentPrize, function(success) {
                        if (success) {
                            playPrizeVideo(currentPrize);
                        } else {
                            showNetworkError();
                        }
                    });
                } else if (nextPrize && !videoCache[nextPrize.name]) {
                    loadVideo(nextPrize, function(success) {
                        if (success) {
                            updateSystemStatus("视频预加载成功", "success");
                        } else {
                            showNetworkError();
                        }
                    });
                } else {
                    updateSystemStatus("无法重试，请检查网络", "error");
                    setTimeout(() => {
                        networkError.style.display = 'block';
                    }, 1000);
                }
            }
            
            // 显示"想屁吃"特效
            function showXiangPiChi() {
                const xiangPiChi = document.createElement('div');
                xiangPiChi.className = 'xiang-pi-chi';
                xiangPiChi.textContent = '想屁吃';
                document.body.appendChild(xiangPiChi);
                
                setTimeout(() => {
                    document.body.removeChild(xiangPiChi);
                }, 3000);
            }
            
            // 事件监听
            spinBtn.addEventListener('click', spinWheel);
            closeVideo.addEventListener('click', closeVideoPlayer);
            closeNetworkError.addEventListener('click', closeVideoPlayer);
            retryNetwork.addEventListener('click', retryNetworkLoad);
            
            // 视频播放结束处理
            videoPlayer.addEventListener('ended', function() {
                replayPrompt.style.display = 'block';
                updateSystemStatus("视频播放完毕", "success");
            });
            
            // 重新播放按钮
            replayYes.addEventListener('click', function() {
                replayVideo();
            });
            
            // 取消重新播放
            replayNo.addEventListener('click', closeVideoPlayer);
            
            // 点击视频容器外部关闭
            videoContainer.addEventListener('click', function(e) {
                if (e.target === videoContainer) {
                    closeVideoPlayer();
                }
            });
            
            // 键盘事件
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && videoContainer.style.display === 'flex') {
                    closeVideoPlayer();
                }
            });
            
            // 初始化系统
            initSystem();
        });
    </script>
</body>
</html>
